<h2 class="mb-4"><i class="bi bi-cart me-2"></i>Shopping Cart</h2>

<% if (cartItems.length === 0) { %>
  <div class="text-center py-5">
    <i class="bi bi-cart-x display-1 text-muted"></i>
    <h4 class="mt-3 text-muted">Your cart is empty</h4>
    <p class="text-muted">Start shopping to add items to your cart.</p>
    <a href="/products" class="btn btn-primary mt-2">
      <i class="bi bi-grid me-1"></i>Browse Products
    </a>
  </div>
<% } else { %>
  <div class="row">
    <div class="col-md-8">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
          <% cartItems.forEach(function(item) { %>
            <div class="d-flex align-items-center p-3 border-bottom">
              <!-- Product Image -->
              <img src="<%= item.Product.image_url || 'data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2780%27 height=%2780%27 viewBox=%270 0 80 80%27%3E%3Crect width=%2780%27 height=%2780%27 fill=%27%23dee2e6%27/%3E%3Ctext x=%2740%27 y=%2744%27 text-anchor=%27middle%27 fill=%27%236c757d%27 font-family=%27Arial%27 font-size=%2712%27%3ENo Image%3C/text%3E%3C/svg%3E' %>"
                   alt="<%= item.Product.name %>"
                   class="rounded me-3"
                   style="width: 80px; height: 80px; object-fit: cover;"
                   onerror="this.onerror=null;this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2780%27 height=%2780%27 viewBox=%270 0 80 80%27%3E%3Crect width=%2780%27 height=%2780%27 fill=%27%23dee2e6%27/%3E%3Ctext x=%2740%27 y=%2744%27 text-anchor=%27middle%27 fill=%27%236c757d%27 font-family=%27Arial%27 font-size=%2712%27%3ENo Image%3C/text%3E%3C/svg%3E'">

              <!-- Product Info -->
              <div class="flex-grow-1">
                <h6 class="mb-1">
                  <a href="/products/<%= item.Product.id %>" class="text-decoration-none">
                    <%= item.Product.name %>
                  </a>
                </h6>
                <span class="text-primary fw-semibold">$<%= parseFloat(item.Product.price).toFixed(2) %></span>
              </div>

              <!-- Quantity Controls -->
              <div class="d-flex align-items-center gap-2">
                <form action="/cart/update/<%= item.id %>" method="POST" class="d-flex align-items-center">
                  <div class="input-group input-group-sm" style="width: 120px;">
                    <button type="button" class="btn btn-outline-secondary qty-btn" data-action="decrease">
                      <i class="bi bi-dash"></i>
                    </button>
                    <input type="number" class="form-control text-center qty-input"
                           name="quantity" value="<%= item.quantity %>" min="1" max="99">
                    <button type="button" class="btn btn-outline-secondary qty-btn" data-action="increase">
                      <i class="bi bi-plus"></i>
                    </button>
                  </div>
                  <button type="submit" class="btn btn-sm btn-outline-primary ms-2" title="Update">
                    <i class="bi bi-arrow-repeat"></i>
                  </button>
                </form>

                <!-- Remove Button -->
                <form action="/cart/remove/<%= item.id %>" method="POST">
                  <button type="submit" class="btn btn-sm btn-outline-danger" title="Remove">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
              </div>

              <!-- Subtotal -->
              <div class="ms-3 text-end" style="min-width: 80px;">
                <span class="fw-bold">$<%= (parseFloat(item.Product.price) * item.quantity).toFixed(2) %></span>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
    </div>

    <!-- Cart Summary -->
    <div class="col-md-4">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Order Summary</h5>
          <hr>
          <div class="d-flex justify-content-between mb-2">
            <span>Items (<%= cartItems.length %>)</span>
            <span>$<%= total %></span>
          </div>
          <hr>
          <div class="d-flex justify-content-between mb-3">
            <strong>Total</strong>
            <strong class="text-primary h5 mb-0">$<%= total %></strong>
          </div>

          <form action="/cart/checkout" method="POST">
            <button type="submit" class="btn btn-primary w-100 btn-lg"
                    onclick="return confirm('Place order? This will clear your cart.')">
              <i class="bi bi-bag-check me-1"></i>Checkout
            </button>
          </form>

          <a href="/products" class="btn btn-outline-secondary w-100 mt-2">
            <i class="bi bi-arrow-left me-1"></i>Continue Shopping
          </a>
        </div>
      </div>
    </div>
  </div>
<% } %>
